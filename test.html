<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Channel Scraper</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <style>
        /* Add your custom styles here */
        
        .post {
            width: calc(33.33% - 16px);
            /* 3 columns with a bit of spacing */
            margin-right: 16px;
            margin-bottom: 16px;
        }
        
        .post img {
            width: 100%;
            height: auto;
            max-height: 150px;
            /* Adjust the maximum height as needed */
            object-fit: cover;
            /* Maintain aspect ratio and cover container */
            border-radius: 8px;
        }
    </style>
</head>

<body class="bg-gray-100">

    <div class="container mx-auto my-8 p-4 bg-white shadow-md rounded-md">
        <h1 class="text-2xl font-bold mb-4">Telegram Channel Scraper Demo</h1>
        <div id="postsContainer" class="flex flex-wrap -mx-4">
            <!-- Posts will be dynamically added here -->
        </div>
        <button id="loadMoreBtn" class="bg-blue-500 text-white px-4 py-2 rounded-md mt-4">Load More</button>
    </div>

    <script>
        const postsContainer = document.getElementById('postsContainer');
        const loadMoreBtn = document.getElementById('loadMoreBtn');
        let lastPostIdCache = null;
        let loading = false;

        async function fetchPosts() {
            if (loading) return;
            loading = true;

            try {
                // Construct the API endpoint based on whether lastPostIdCache is available
                const endpoint = lastPostIdCache ?
                    `/get_post/ethio_market_place?after=${lastPostIdCache - 1}` :
                    '/get_posts/ethio_market_place';

                const response = await fetch(`https://telegram-channel-scraper-api.vercel.app/api/v2${endpoint}`);
                const posts = await response.json();

                if (posts.length > 0) {
                    // Extract the new last post ID
                    const newLastPostId = posts[posts.length - 1].id;

                    if (!lastPostIdCache) {
                        // Initial load: Subtract 20 from the new last post ID and save it in cache
                        lastPostIdCache = newLastPostId - 20;
                    } else {
                        // Load More: Update the cache with the new last post ID
                        lastPostIdCache = newLastPostId;
                    }

                    posts.forEach(post => {
                        const postElement = document.createElement('div');
                        postElement.className = 'post px-4';
                        postElement.innerHTML = `
              <img src="${post.photos[0]}" alt="Post Image" class="max-w-full">
              <p class="mt-2">${post.description}</p>
            `;
                        postsContainer.appendChild(postElement);
                    });

                    loading = false;
                } else {
                    loadMoreBtn.disabled = true;
                    loadMoreBtn.textContent = 'No More Posts';
                }
            } catch (error) {
                console.error('Error fetching posts:', error);
                loading = false;
            }
        }

        loadMoreBtn.addEventListener('click', fetchPosts);

        // Initial load
        fetchPosts();
    </script>

</body>

</html>